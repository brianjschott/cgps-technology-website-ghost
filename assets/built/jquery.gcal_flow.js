(function(){var e,t,i,a,n,o,l,w=jQuery,k={};if(k.error=k.warn=k.log=k.info=k.debug=function(){},"undefined"!=typeof window&&null!==window&&"undefined"!=typeof console&&null!==console&&null!=console.log){if(!window._gCalFlow_quiet)for(t=0,i=(l=["error","warn","info"]).length;t<i;t++)k[o=l[t]]=function(){return console[o]?console[o].apply(console,arguments):console.log.apply(console,arguments)};window._gCalFlow_debug&&(k.debug=function(){return null!=console.debug?console.debug.apply(console,arguments):console.log.apply(console,arguments)})}function s(t,e){(this.target=t).addClass("gCalFlow"),0<t.children().size()&&(k.debug("Target node has children, use target element as template."),this.template=t),this.update_opts(e)}n=function(t,e){var i,a,o;if(null==e&&(e=2),10*(e-1)<=t)return t;for(i=1,a=e-((o="")+t).length;1<=a?i<=a:a<=i;1<=a?++i:--i)o=o.concat("0");return o.concat(t)},s.demo_apikey="AIzaSyD0vtTUjLXzH4oKCzNRDymL6E3jKBympf0",s.prototype.target=null,s.prototype.template=w('<div class="gCalFlow">\n  <div class="gcf-header-block">\n    <div class="gcf-title-block">\n      <span class="gcf-title"></span>\n    </div>\n  </div>\n  <div class="gcf-item-container-block">\n    <div class="gcf-item-block">\n      <div class="gcf-item-header-block">\n        <div class="gcf-item-date-block">\n          [<span class="gcf-item-daterange"></span>]\n        </div>\n        <div class="gcf-item-title-block">\n          <strong class="gcf-item-title"></strong>\n        </div>\n      </div>\n      <div class="gcf-item-body-block">\n        <div class="gcf-item-description">\n        </div>\n        <div class="gcf-item-location">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="gcf-last-update-block">\n    LastUpdate: <span class="gcf-last-update"></span>\n  </div>\n</div>'),s.prototype.opts={maxitem:15,calid:null,apikey:s.demo_apikey,mode:"upcoming",data_url:null,auto_scroll:!0,scroll_interval:1e4,link_title:!0,link_item_title:!0,link_item_description:!1,link_item_location:!1,link_target:"_blank",item_description_as_html:!1,callback:null,no_items_html:"",globalize_culture:"undefined"!=typeof navigator&&null!==navigator&&(navigator.browserLanguage||navigator.language||navigator.userLanguage),globalize_fmt_datetime:"f",globalize_fmt_date:"D",globalize_fmt_time:"t",globalize_fmt_monthday:"M",date_formatter:function(t,e){var i;return"undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.format?(i=e?this.globalize_fmt_date:this.globalize_fmt_datetime,Globalize.format(t,i)):e?t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate()):t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate())+" "+n(t.getHours())+":"+n(t.getMinutes())},daterange_formatter:function(t,e,i){var a,o=this.date_formatter(t,i);return i&&(e=new Date(e.getTime()-864e5)),a="",t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()||("undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.format?a+=Globalize.format(e,this.globalize_fmt_monthday):a+=n(e.getMonth()+1)+"-"+n(e.getDate())),i||t.getHours()===e.getHours()&&t.getMinutes()===e.getMinutes()||("undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.format?a+=Globalize.format(e,this.globalize_fmt_time):a+=" "+n(e.getHours())+":"+n(e.getMinutes())),a&&(o+=" - "+a),o}},s.prototype.update_opts=function(t){return k.debug("update_opts was called"),k.debug("old options:",this.opts),this.opts=w.extend({},this.opts,t),k.debug("new options:",this.opts)},s.prototype.gcal_url=function(){var t;if(!this.opts.calid&&!this.opts.data_url)throw k.error("Option calid and data_url are missing. Abort URL generation"),this.target.text("Error: You need to set 'calid' or 'data_url' option."),"gCalFlow: calid and data_url missing";return this.opts.data_url?this.opts.data_url:"updates"===this.opts.mode?(t=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=updated&timeMin="+t+"&singleEvents=true"):(t=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=startTime&timeMin="+t+"&singleEvents=true")},s.prototype.fetch=function(){var t,e;return k.debug("Starting ajax call for "+this.gcal_url()),this.opts.apikey===this.constructor.demo_apikey&&(k.warn("You are using built-in demo API key! This key is provided for tiny use or demo only. Your access may be limited."),k.warn("Please check document and consider to use your own key.")),e=this,t=function(t){return k.debug("Ajax call success. Response data:",t),e.render_data(t,e)},w.ajax({type:"GET",success:t,dataType:"jsonp",url:this.gcal_url()})},s.prototype.parse_date=function(t){var e,i,a,o,n,l,s,r,d;return(a=t.match(/^(\d{4})-(\d{2})-(\d{2})$/))?new Date(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),0,0,0):(l=60*(new Date).getTimezoneOffset()*1e3,d=n=e=null,i=o=r=0,(a=t.match(/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|([+-])(\d{2}):(\d{2}))$/))?(d=parseInt(a[1],10),n=parseInt(a[2],10),e=parseInt(a[3],10),i=parseInt(a[4],10),o=parseInt(a[5],10),r=parseInt(a[6],10),l=60*new Date(d,n-1,e,i,o,r).getTimezoneOffset()*1e3,"Z"!==a[7]&&(l+=("+"===a[8]?1:-1)*(60*parseInt(a[9],10)+parseInt(a[10],10))*1e3*60),k.debug("time parse (gap to local): "+l),s=new Date(new Date(d,n-1,e,i,o,r).getTime()-l),k.debug("time parse: "+t+" -> ",s),s):(k.warn("Time parse error! Unknown time pattern: "+t),new Date(1970,1,1,0,0,0)))},s.prototype.render_data=function(t){var e,i,a,o,n,l,s,r,d,c,g,p,u,m,f,h,_,b,y,v;if(k.debug("start rendering for data:",t),y=this.template.clone(),v=null!=(m=this.opts.titlelink)?m:"http://www.google.com/calendar/embed?src="+this.opts.calid,this.opts.link_title?y.find(".gcf-title").html(w("<a />").attr({target:this.opts.link_target,href:v}).text(t.summary)):y.find(".gcf-title").text(t.summary),y.find(".gcf-link").attr({target:this.opts.link_target,href:v}),y.find(".gcf-last-update").html(this.opts.date_formatter(this.parse_date(t.updated))),(d=y.find(".gcf-item-block")).detach(),d=w(d[0]),k.debug("item block template:",d),c=w(),k.debug("render entries:",t.items),i=this.opts.item_description_as_html?"html":"text",null!=t.items&&0<t.items.length)for(g=0,p=(f=t.items.slice(0,+this.opts.maxitem+1||9e9)).length;g<p;g++)o=f[g],k.debug("formatting entry:",o),e=d.clone(),o.start&&(_=o.start.dateTime?o.start.dateTime:o.start.date,h=this.parse_date(_),b=this.opts.date_formatter(h,_.indexOf(":")<0),e.find(".gcf-item-date").html(b),e.find(".gcf-item-start-date").html(b)),o.end&&(n=o.end.dateTime?o.end.dateTime:o.end.date,a=this.parse_date(n),l=this.opts.date_formatter(a,n.indexOf(":")<0),e.find(".gcf-item-end-date").html(l),e.find(".gcf-item-daterange").html(this.opts.daterange_formatter(h,a,_.indexOf(":")<0))),e.find(".gcf-item-update-date").html(this.opts.date_formatter(this.parse_date(o.updated),!1)),u=w("<a />").attr({target:this.opts.link_target,href:o.htmlLink}),this.opts.link_item_title?e.find(".gcf-item-title").html(u.clone().text(o.summary)):e.find(".gcf-item-title").text(o.summary),this.opts.link_item_description?e.find(".gcf-item-description").html(u.clone()[i](o.description)):e.find(".gcf-item-description")[i](o.description),this.opts.link_item_location&&o.location?(s="<a href='https://maps.google.de/maps?q="+encodeURI(o.location.toString().replace(" ","+"))+"' target='new'>"+o.location+"</a>",e.find(".gcf-item-location").html(s)):e.find(".gcf-item-location").text(o.location),e.find(".gcf-item-link").attr({href:o.htmlLink}),k.debug("formatted item entry:",e[0]),c.push(e[0]);else c=w('<div class="gcf-no-items"></div>').html(this.opts.no_items_html);if(k.debug("formatted item entry array:",c),r=y.find(".gcf-item-container-block"),k.debug("item container element:",r),r.html(c),this.target.html(y.html()),this.bind_scroll(),this.opts.callback)return this.opts.callback.apply(this.target)},s.prototype.bind_scroll=function(){var e,i=this.target.find(".gcf-item-container-block"),a=i.find(".gcf-item-block");if(k.debug("scroll container:",i),!(!this.opts.auto_scroll||i.size()<1||a.size()<2))return e={idx:0},setInterval(function(){var t;return k.debug("current scroll position:",i.scrollTop()),k.debug("scroll capacity:",i[0].scrollHeight-i[0].clientHeight),void 0===a[e.idx]||i.scrollTop()>=i[0].scrollHeight-i[0].clientHeight?(k.debug("scroll to top"),e.idx=0,i.animate({scrollTop:a[0].offsetTop})):(t=a[e.idx].offsetTop,k.debug("scroll to "+t+"px"),i.animate({scrollTop:t}),e.idx+=1)},this.opts.scroll_interval)},e=s,a={init:function(t){if(null==t&&(t={}),!this.data("gCalFlow"))return this.data("gCalFlow",{target:this,obj:new e(this,t)})},destroy:function(){var t=this.data("gCalFlow");return t.obj.target=null,w(window).unbind(".gCalFlow"),t.gCalFlow.remove(),this.removeData("gCalFlow")},render:function(){return"undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.culture&&Globalize.culture(this.data("gCalFlow").obj.opts.globalize_culture),this.data("gCalFlow").obj.fetch()}},w.fn.gCalFlow=function(t){var e=arguments;return"object"!=typeof t&&t?a[t]?this.each(function(){return a[t].apply(w(this),Array.prototype.slice.call(e,1))}):"version"===t?"3.0.2":w.error("Method "+t+" does not exist on jQuery.gCalFlow"):this.each(function(){return a.init.apply(w(this),e),a.render.apply(w(this),e)})}}).call(this);
//# sourceMappingURL=jquery.gcal_flow.js.map